<!DOCTYPE HTML>
<html>
  <head>
    <metacontent="charset=utf-8">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Percentage of periods</title>
    <style type="text/css">
      * {
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* Internet Explorer */
        -khtml-user-select: none; /* KHTML browsers (e.g. Konqueror) */
        -webkit-user-select: none; /* Chrome, Safari, and Opera */
        -webkit-touch-callout: none; /* Disable Android and iOS callouts*/
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }

      /* js: minimal min-width 300/min-height 600.
        If client size bigger - size of body almost all of client */
      body{
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: Verdana;
        font-size: 1.1em;
        /* min-width, min-height - set when the window is opened/reloaded */
      }
      p {
        margin: 0;
        text-align: center;
      }
      .idents {
        margin: 0 10px;
        padding: 5px;
      }

      /* js: minmal width 300/height 600. If body bigger - size almost all of body*/
      #container {
        display: flex;
        flex-flow: column;
        /*border: 1px solid grey;*/
        /* width, height - set when the window is opened/reloaded */
      }
      #container .header { /* flex: height - depends on content of .header */
        flex: 0 1 auto;
        border-bottom: 1px solid grey;
      }

      /* flex: height - all #container except .header + .footer height */
      #container .content {
        flex: 1 1 auto;
        margin: 10px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      #container .footer { /* flex: height - depends on content of .footer */
        flex: 0 1 auto;
        border-top: 1px solid grey;
      }

      /* js+flex: height/margin-bottom is dynamic,
        depends on .content height and number of .bar's */
      .content .bar {
        display: flex;
        justify-content: center;
        align-items: center;
        flex: 0 1 auto;
        border: 1px dashed black;
        border-radius: 10px;
        width: 100%;
        background-color: rgba(200,200,200,0.2);
        cursor: pointer;
        
        /*height, margin-bottom - set when the window is opened/reloaded */
      }

      .footer a {
        color: black;
      }
      .content .bar-active { /* flex: height occupies all free space of .content */
        border: 1px solid blue;
        flex: 1 1 auto;
        background-color: rgba(200,200,200,0.8);
        
        /*height - all free space of .content except non-active bar */
      }
    </style>
   </head>

  <body>

    <div id="container">

      <div class="header idents">
        <p><b>Percentage of periodss</b></p>
      </div>

      <div class="content">
        <div class="bar" id="bar0"><p><span id="span_bar0"></span>Minute</p></div>
        <div class="bar" id="bar1"><p><span id="span_bar1"></span>Hour</p></div>
        <div class="bar" id="bar2"><p><span id="span_bar2"></span>Day</p></div>
        <div class="bar" id="bar3"><p><span id="span_bar3"></span>Week</p></div>
        <div class="bar" id="bar4"><p><span id="span_bar4"></span>Month</p></div>
        <div class="bar" id="bar5"><p><span id="span_bar5"></span>Quarter</p></div>
        <div class="bar" id="bar6"><p><span id="span_bar6"></span>Year</p></div>
    <!--<div class="bar" id="bar7"><p><span id="span_bar7"></span>Decade</p></div>
        <div class="bar" id="bar8"><p><span id="span_bar8"></span>25-Year</p></div>
        <div class="bar" id="bar9"><p><span id="span_bar9"></span>Century?</p></div> 
        <div class="bar" id="bar10"><p><span id="span_bar10">Life?</p></div> -->
      </div>

      <div class="footer idents">
        <p>by <a href="http://www.budladislav.info/">Budladislav</a> jan.2019</p>
      </div>

    </div>

    <script type="text/javascript" src="jquery-3.3.1.min.js"></script>
    <script type="text/javascript">
      'use strict';

    /* GLOBAL VARIABLES */
      let o_GlobalVariables = {
        //used for construct different kinds of object Bar
        aBarsType: ['0_minute', '1_hour', '2_day','3_week','4_month','5_quarter',
          '6_year'], //first char - number of bar id
        aBars: [], // array with all Bar objects

        /* temporary values used for forbidding use events before animation of fill ends.
          remove them when all bars percentage counting will work*/
        lastNonZeroBar: 4, //manual. Menans last work index of array aBarsType
        bAllowEvents: false
      }

    /* GLOBAL VARIABLES end */

    /* CONSTRUCTORS */
      let Bar = function(type) {
        this.barIdNum = type[0];
        this.bar = document.getElementById(`bar${this.barIdNum}`);
        this.barId = this.bar.id;
        this.span = document.getElementById(`span_bar${this.barIdNum}`);  

        //Manual, temporary. remove when active condition determined by localStorage var
        if (this.barIdNum === '3'){
          this.active = true;
        }

        //Manual, temporary. remove when all bars percentage counting will work
        if (this.barIdNum === '3' || this.barIdNum === '4'){
          this.work = true;
        }

        this.percent = this.getPersent(type); //each type of Bar has own %
        this.percent = +this.percent.toFixed(2); 
        this.activeMessage = this.percent + '% of current ';

        this.percentVisualSet(); // animate 'progress' of bar
      }

    /* CONSTRUCTORS end */

    /* PROTOTYPE PROPERTYS */
      Bar.prototype.active = false; //default all bars don't active  
    /* PROTOTYPE PROPERTYS end */

    /* PROTOTYPE METHODS */

      //new proto method for Date(), return days in the month. Get it from habr
      Date.prototype.daysInMonth = function() {
        return 33 - new Date(this.getFullYear(), this.getMonth(), 33).getDate();
      };

      //return % for current type bar
      Bar.prototype.getPersent = function(type){
        let dDate = new Date();
        let nDay = dDate.getDate(); //1-31
        let nDayOfWeek = dDate.getDay(); //1-7
        let nMonth = dDate.getMonth(); //0-11
        let nYear = dDate.getFullYear(); //2019 f.e.
        let nDaysInCurrentMonth = dDate.daysInMonth();

        if (this.active){
          this.activateBar(); 
        }

        switch (type) {
          case '3_week':
            return (nDayOfWeek / 7) * 100;
          case '4_month':
            return (nDay / nDaysInCurrentMonth) * 100;
          default : 
            return 0;
        }
      }
      // animate 'progress' of bar
      Bar.prototype.percentVisualSet = function(){
        let nOnePercentOfCurrentPercent = +(this.percent / 100);
        let nCurrentPercent = nOnePercentOfCurrentPercent;
        let nIntervalId;

        //until nCurrentPercent <= this.percent,
        //linear-gradient incerease by 1% of this.percent, and change span text
        nIntervalId = setInterval(()=>{
          //temporary workaround, remove text for non-worked bar spans
          if(this.percent === 0){
            $(this.span).text('');
            clearInterval(nIntervalId);
            return;
          }


          $(this.bar).css('background',`linear-gradient(to right,` +
            ` rgba(175,175,175,1) ${nCurrentPercent.toFixed(2)}%,` +
            ` rgba(200,200,200,0.2) 0%)`);
          $(this.span).text(nCurrentPercent.toFixed(2) + '%');
          if (nCurrentPercent <= this.percent - nOnePercentOfCurrentPercent){
            nCurrentPercent += nOnePercentOfCurrentPercent;
          } else { //enough, end of animation
            clearInterval(nIntervalId);
            $(this.span).text('');
            if (this.active) {
              $(this.span).text(this.activeMessage);
            }

            //temporary, remove when all bars persent count will finished
            //after last fill animation ends - allow events
            if (+this.barIdNum === o_GlobalVariables.lastNonZeroBar){
              o_GlobalVariables.bAllowEvents = true;
            }
          }
        },8);
      }

      //change appearance and text of bar
      Bar.prototype.activateBar = function(){
        $(this.bar).addClass('bar-active');
        //$(this.span).text(this.activeMessage)

        //temporary check on work
        if (this.work){
          $(this.span).text(this.activeMessage);
        } else{
          $(this.span).text('"in progress" ');
        }
        
      }

      //change appearance and text of bar to default. is it useble
      // Bar.prototype.deactivateBar = function(){
      //   $(this.bar).removeClass('bar-active');
      //   $(this.span).text('');
      // }

    /* PROTOTYPE METHODS end */

    /* FUNCTIONS */

      /*setup intrface. Used for dynamic setting sizes of elements.
      min-width 300px, min-height 600px. if client size fewer - scrollbars
      if bigger - content size expands to client size*/
      let fSetInterface = () => {
        let n_WindowWidth = document.documentElement.clientWidth;
        let n_WindowHeight = document.documentElement.clientHeight;
        let n_ContainerWidth;
        let n_ContainerHeight;

        if (n_WindowWidth < 300){
          n_ContainerWidth = 300;
        } else {
          n_ContainerWidth = n_WindowWidth * 0.975;
        }
        if (n_WindowHeight < 600){
          n_ContainerHeight = 600;
        } else {
          n_ContainerHeight = n_WindowHeight * 0.975;
        }

        $('body').css({
          'min-width' : n_ContainerWidth + 'px',
          'min-height' : n_ContainerHeight + 'px'
        });

        $('#container').css({
          'width' : n_ContainerWidth + 'px',
          'height' : n_ContainerHeight + 'px'
        });

        let nNumberOfBars = o_GlobalVariables.aBarsType.length;
        let n_ContentHeight = $('.content').height();
        let n_ContentVoid = n_ContentHeight / 5; //void place that active bar will fill
        let n_BarHeight = (n_ContentHeight - n_ContentVoid) / nNumberOfBars;
        let n_Margin = n_BarHeight / 10;

        $('.bar').css({
          'margin-bottom': n_Margin + 'px',
          'height': n_BarHeight + 'px'
        });

        //Set text bigger on mobile devices
        if (fIsMobile()){
          $('body').css('font-size','2em');
        }
      }

      //check is it device mobile (with touchscreen). True - mobile/ false - desctop
      function fIsMobile() { return ('ontouchstart' in document.documentElement); }

      let deactivateAllBars = (aBars) => {
        for (let i = 0; i < o_GlobalVariables.aBars.length; i++){
          aBars[i].bar.classList.remove("bar-active");
          aBars[i].span.innerHTML = '';
        }
      }
      
    /* FUNCTIONS end */

    /* EVENTS */

        //click on any bar. Deactivate all bars and activate clicked
        $('.bar').click((event)=>{
          //temporary - remove when all bars count will be work
          if (!o_GlobalVariables.bAllowEvents){ //don't do any if false
            return;
          }


          let aOfBars = o_GlobalVariables.aBars
          deactivateAllBars(o_GlobalVariables.aBars);
          for (let i = aOfBars.length - 1; i >= 0; i--) {
            if (aOfBars[i].barId === event.target.id){
              aOfBars[i].activateBar();
              return;
            }
          }
        });

    /* EVENTS end */

    /* MAIN CODE */
      // setup interface. 
      fSetInterface();
      //Construct all type of bars
      for (let i = 0; i < o_GlobalVariables.aBarsType.length; i++){
        o_GlobalVariables.aBars[i] = new Bar(o_GlobalVariables.aBarsType[i]);
      }

    /* MAIN CODE end */
    </script>

  </body>
</html>